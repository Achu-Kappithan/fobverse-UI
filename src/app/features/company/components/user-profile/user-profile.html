<div
  class="bg-lavender text-dark-gray  flex items-center justify-center py-8  custom-scrollbar transition-colors duration-300 relative"
>
  <div class="w-full max-w-4xl flex flex-col lg:flex-row items-start gap-6">
    <div
      class="w-full lg:w-20 bg-white rounded-xl shadow-lg p-4 flex lg:flex-col justify-around items-center space-x-4 lg:space-x-0 lg:space-y-4 border border-gray-300 transition-colors duration-300"
    >
      <button
        class="relative p-3 rounded-lg text-gray-500 hover:text-purple group"
        [class.text-purple]="activeCard === 'profile'"
        (click)="setActiveCard('profile')"
      >
        <i class="fas fa-user text-xl"></i>
        <span
          class="absolute inset-x-0 bottom-0 h-1 bg-purple-600 rounded-b-lg transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300"
          [class.scale-x-100]="activeCard === 'profile'"
        ></span>
      </button>
      <button
        class="relative p-3 rounded-lg text-gray-500 hover:text-purple group"
        [class.text-purple]="activeCard === 'password'"
        (click)="setActiveCard('password')"
      >
        <i class="fas fa-lock text-xl"></i>
        <span
          class="absolute inset-x-0 bottom-0 h-1 bg-purple-600 rounded-b-lg transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300"
          [class.scale-x-100]="activeCard === 'password'"
        ></span>
      </button>
      <button
        class="relative p-3 rounded-lg text-gray-500 hover:text-purple group"
        [class.text-purple]="activeCard === 'edit'"
        (click)="setActiveCard('edit')"
      >
        <i class="fas fa-edit text-xl"></i>
        <span
          class="absolute inset-x-0 bottom-0 h-1 bg-purple-600 rounded-b-lg transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300"
          [class.scale-x-100]="activeCard === 'edit'"
        ></span>
      </button>
    </div>

    <div
      class="flex-1 bg-white rounded-2xl shadow-xl p-10 relative w-full"
      *ngIf="activeCard === 'profile'"
    >
      <div class="flex flex-col md:flex-row justify-between gap-8">
        <div class="space-y-5 w-full md:w-2/3">
          <h1 class="text-4xl font-extrabold text-gray-900 mb-4">Profile</h1>

          <hr />
          <div class="flex items-center gap-3 mt-4">
            <div class="p-2 bg-pink-100 rounded-full">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-pink-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 7V6a2 2 0 012-2h8a2 2 0 012 2v1m4 0v11a2 2 0 01-2 2H4a2 2 0 01-2-2V7h20zm-6 4h.01M10 11h.01M6 11h.01M6 15h.01M10 15h.01M14 15h.01M18 15h.01M14 11h.01M18 11h.01"
                />
              </svg>
            </div>

            <div>
              <label class="block text-xs font-semibold text-gray-500 uppercase"
                >User Role</label
              >
              <p
                class="text-base font-semibold text-gray-800 tracking-wide"
                *ngIf="userProfile"
              >
                {{ userProfile.role | roleDisplay }}
              </p>
              <p
                class="text-base font-semibold text-gray-800 tracking-wide"
                *ngIf="isLoading"
              >
                Loading...
              </p>
            </div>
          </div>
          <br />
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-semibold text-gray-500 uppercase"
                >User Name</label
              >
              <p class="text-lg font-medium text-gray-800" *ngIf="userProfile">
                {{ userProfile.name }}
              </p>
              <p class="text-lg font-medium text-gray-800" *ngIf="isLoading">
                Loading...
              </p>
            </div>
            <div>
              <label class="block text-xs font-semibold text-gray-500 uppercase"
                >E-mail</label
              >
              <p class="text-lg font-medium text-gray-800" *ngIf="userProfile">
                {{ userProfile.email }}
              </p>
              <p class="text-lg font-medium text-gray-800" *ngIf="isLoading">
                Loading...
              </p>
            </div>
            </div>
        </div>

        <div class="relative w-32 h-32 mx-auto md:mx-0 mt-6 md:mt-0">
          <img
            [src]="userProfile?.profileImg || 'https://placehold.co/150x150'"
            alt="User"
            class="rounded-full w-full h-full object-cover border-4 border-purple-600 shadow-lg"
          />
        </div>
      </div>
      <div
        *ngIf="isLoading"
        class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 rounded-2xl"
      >
        <div
          class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-purple-500"
        ></div>
      </div>
    </div>

    <div
      class="flex-1 bg-white rounded-2xl shadow-xl p-10 relative w-full"
      *ngIf="activeCard === 'password'"
    >
      <div class="flex flex-col md:flex-row justify-between gap-8">
        <div class="mt-10 space-y-6 w-full max-w-md mx-auto">
          <h2 class="text-xl font-bold text-gray-800 mb-2">Change Password</h2>

          <hr />
          <form
            [formGroup]="passwordChangeForm"
            (ngSubmit)="onChangePasswordSubmit()"
            class="space-y-5"
          >
            <div>
              <label
                for="currentPassword"
                class="block text-sm font-medium text-gray-700"
                >Current Password</label
              >
              <input
                type="password"
                id="currentPassword"
                formControlName="currentPassword"
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm"
              />
              <div
                *ngIf="
                  passwordChangeForm.get('currentPassword')?.invalid &&
                  passwordChangeForm.get('currentPassword')?.touched
                "
                class="text-red-500 text-xs mt-1"
              >
                Current password is required.
              </div>
            </div>

            <div>
              <label
                for="newPassword"
                class="block text-sm font-medium text-gray-700"
                >New Password</label
              >
              <input
                type="password"
                id="newPassword"
                formControlName="newPassword"
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm"
              />
              <div
                *ngIf="
                  passwordChangeForm.get('newPassword')?.invalid &&
                  passwordChangeForm.get('newPassword')?.touched
                "
                class="text-red-500 text-xs mt-1"
              >
                <span
                  *ngIf="passwordChangeForm.get('newPassword')?.errors?.['required']"
                  >New password is required.</span
                >
                <span
                  *ngIf="passwordChangeForm.get('newPassword')?.errors?.['minlength']"
                  >Password must be at least 6 characters.</span
                >
              </div>
            </div>

            <div>
              <label
                for="confirmNewPassword"
                class="block text-sm font-medium text-gray-700"
                >Confirm New Password</label
              >
              <input
                type="password"
                id="confirmNewPassword"
                formControlName="confirmNewPassword"
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm"
              />
              <p
                class="text-xs text-red-500 mt-1"
                *ngIf="
                  passwordChangeForm.get('confirmNewPassword')?.errors?.['mismatch'] &&
                  passwordChangeForm.get('confirmNewPassword')?.touched
                "
                id="passwordMismatchMsg"
              >
                Passwords do not match.
              </p>
              <div
                *ngIf="
                  passwordChangeForm.get('confirmNewPassword')?.invalid &&
                  passwordChangeForm.get('confirmNewPassword')?.touched &&
                  !passwordChangeForm.get('confirmNewPassword')?.errors?.['mismatch']
                "
                class="text-red-500 text-xs mt-1"
              >
                Confirm new password is required.
              </div>
            </div>

            <div class="pt-4 flex justify-end">
              <button
                type="submit"
                [disabled]="passwordChangeForm.invalid || isLoading"
                class="px-8 py-3 rounded-lg shadow-md bg-gradient-to-r from-pink-500 to-orange-400 text-white hover:shadow-lg hover:from-pink-600 hover:to-orange-500 transition-all duration-300 transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span *ngIf="!isLoading">Change Password</span>
                <span *ngIf="isLoading">Changing...</span>
              </button>
            </div>
          </form>
        </div>
        <div
          *ngIf="isLoading && activeCard === 'password'"
          class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 rounded-2xl"
        >
          <div
            class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-purple-500"
          ></div>
        </div>
      </div>
    </div>

    <div
      class="flex-1 bg-white rounded-2xl shadow-xl p-10 relative w-full"
      *ngIf="activeCard === 'edit'"
    >
      <div class="flex flex-col md:flex-row justify-between gap-8">
        <div class="mt-10 space-y-4 w-full">
          <h2 class="text-xl font-bold text-gray-800 mb-2">Edit Profile</h2>
          <hr />
          <div class="relative w-32 h-32 mx-auto md:mx-0 mt-6 mb-8">
            <img
              [src]="
                previewImage || userProfile?.profileImg || 'https://placehold.co/150x150'
              "
              alt="User"
              class="rounded-full w-full h-full object-cover border-4 border-purple-600 shadow-lg"
            />
            <label
              class="absolute bottom-2 right-2 bg-white p-2 rounded-full shadow-md cursor-pointer hover:bg-gray-100 transition"
            >
              <i class="fas fa-camera text-gray-600"></i>
              <input
                type="file"
                class="hidden"
                (change)="onFileSelected($event)"
                accept="image/*"
              />
            </label>
          </div>

          <form
            [formGroup]="updateProfileForm"
            (ngSubmit)="onUpdateProfileSubmit()"
            class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4"
          >
            <div>
              <label
                for="editName"
                class="block text-sm font-medium text-gray-700"
                >Name</label
              >
              <input
                type="text"
                id="editName"
                formControlName="name"
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm"
              />
              <div
                *ngIf="
                  updateProfileForm.get('name')?.invalid &&
                  updateProfileForm.get('name')?.touched
                "
                class="text-red-500 text-xs mt-1"
              >
                Name is required.
              </div>
            </div>

            <div>
              <label
                for="editEmail"
                class="block text-sm font-medium text-gray-700"
                >Email</label
              >
              <input
                type="email"
                id="editEmail"
                formControlName="email"
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm"
              />
              <div
                *ngIf="
                  updateProfileForm.get('email')?.invalid &&
                  updateProfileForm.get('email')?.touched
                "
                class="text-red-500 text-xs mt-1"
              >
                <span *ngIf="updateProfileForm.get('email')?.errors?.['required']"
                  >Email is required.</span
                >
                <span *ngIf="updateProfileForm.get('email')?.errors?.['email']"
                  >Invalid email format.</span
                >
              </div>
            </div>

            <div class="col-span-full pt-4 flex justify-end">
              <button
                type="submit"
                [disabled]="updateProfileForm.invalid || isLoading"
                class="px-8 py-3 rounded-lg shadow-md bg-gradient-to-r from-pink-500 to-orange-400 text-white hover:shadow-lg hover:from-pink-600 hover:to-orange-500 transition-all duration-300 transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span *ngIf="!isLoading">Save Changes</span>
                <span *ngIf="isLoading">Saving...</span>
              </button>
            </div>
          </form>
        </div>
      </div>
      <div
        *ngIf="isLoading && activeCard === 'edit'"
        class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 rounded-2xl"
      >
        <div
          class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-purple-500"
        ></div>
      </div>
    </div>
  </div>
</div>